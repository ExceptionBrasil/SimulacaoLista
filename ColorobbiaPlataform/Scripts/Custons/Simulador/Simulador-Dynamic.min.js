var Simulador=function(){function n(n){return n===undefined?0:n.innerHTML===undefined&&n.innerText===undefined?0:(n=n.innerHTML,isNaN(parseFloat(n)))?0:parseFloat(n.replace(",","."))}function e(){return parseFloat(document.getElementById("RendimentoEscolhido").innerHTML.replace(",","."))}function r(){for(var o,f,h,y,u=$("table#tabEstrutura"),p=e(),s=0,w=document.querySelector("#CustoIndustrial"),g=document.querySelector("#Embalagem"),nt=document.querySelector("#CustoOperacional"),b=document.querySelector("#DespesasOperacionaisCalculada"),tt=document.querySelector("#DespesaOperacional"),k=document.querySelector("#CustoTotalDoProduto"),it=document.querySelector("#CustoTotalDoProdutoMargem"),rt=document.querySelector("#PrecoBase"),ut=document.querySelector("#MargemLucro"),ft=document.querySelector("#Icms7"),et=document.querySelector("#Icms12"),ot=document.querySelector("#Icms18"),c=0,l=0,d=0,a=0,r=0;r<u.length;r++){for(o=[],f=0;f<u[r].rows.length;f++)if($(u[r].rows[f]).attr("total-line")==="true")s=f;else for(h=0;h<u[r].rows[f].cells.length;h++)y=u[r].rows[f].cells[h],f===0?o[h]=n(y):o[h]+=n(y);u[r].rows[s].cells[t].innerHTML=o[t].toFixed(2);u[r].rows[s].cells[i].innerHTML=(o[i]/(p/100)).toFixed(4);r===0&&(a=o[i]/(p/100)+n(g)+n(nt),w.innerHTML=a.toFixed(4),b.innerHTML=(a*(n(tt)/100)).toFixed(4),d=n(b)+n(w),k.innerHTML=d.toFixed(4),l=n(k)*1.05,it.innerHTML=l.toFixed(4),c=l/((100-n(ut))/100),rt.innerHTML=c.toFixed(4),ft.innerHTML=(c/.8375).toFixed(4),et.innerHTML=(c/.7875).toFixed(4),ot.innerHTML=(c/.7275).toFixed(4));o[t]>100.009?(v("A fórmula do "+u[r].rows[s-2].cells[1].innerText+" ultrapassa os 100%","danger"),$(u[r].rows[s].cells[t]).addClass("alert alert-danger")):$(u[r].rows[s].cells[t]).removeClass("alert alert-danger")}SimuladorChart.Update()}function v(n,t){$.notify({icon:"http://192.168.1.15:10300/Content/Imagens/Icons/error-30_amarelo.png",message:n},{type:t,placement:{from:"bottom"},animate:{enter:"animated fadeInRight",exit:"animated flipOutX"},allow_dismiss:!0,icon_type:"image"})}function o(r){var c=e(),u=$(r).attr("compute");if(u!=="NO"){var o=n(r.cells[t]),s=n(r.cells[f]),h=s*(o/100);r.cells[i]!==undefined&&(r.cells[i].innerText=h.toFixed(4))}}function w(n){var t=document.querySelector("#Filial");WebService.Init({search:n,filial:t.value},"/SimulacaoLista/Produto/GetProdutoBySeachAsync",function(n){for(var r,u=document.querySelector("#ListCodigoDoProduto"),i="",t=0;t<n.produtos.length;t++)r=n.produtos[t].trim(),i+="<option value='"+r+"'>";u.innerHTML=i})}function k(){for(var t=$("table#tabEstrutura"),n=0;n<t[0].rows.length;n++)$(t[0].rows[n]).attr("total-line")==="true"&&(t[0].insertRow(n),t[0].rows[n].innerHTML=`<td remove='true'><a href='#'><img src='/Content/Imagens/Icons/menos-16.png' /></a></td>
                                <td></td>
                                <td></td>
                                <td editableProduct='true' > </td>                                                     
                                <td></td>
                                <td></td>
                                <td editable='true'></td>
                                <td></td>
                                <td total-column='true'></td>`,n+=2);s()}function d(n){n.stopPropagation();n.preventDefault();tabelasBase=$("table#tabBase");tabelasEstrutura=$("table#tabEstrutura");nt(tabelasBase[0],tabelasEstrutura[0]);var t=g(),i="",r="",u="";t>0?(i="A Fórmula ficou "+t+"% mais cara",r="warning",u="http://192.168.1.15:10300/Content/Imagens/Icons/high-priority-40.png"):(i=t===0?"Sem alterações valor da fórmula":"A Fórmula ficou "+t+"% mais barata",r="success",u="http://192.168.1.15:10300/Content/Imagens/Icons/ok-48.png");$.notify({icon:u,message:i},{type:r,placement:{from:"top",align:"right"},animate:{enter:"animated fadeInRight",exit:"animated flipOutX"},allow_dismiss:!0,icon_type:"image",delay:2e3})}function g(){var t=n(document.querySelector("#TotalDoProdutoBase")),i=n(document.querySelector("#CustoTotalDoProduto"));return t===i?0:((1-t/i)*100).toFixed(2)}function nt(n,t){for(var i,r,f="",u=0;u<n.rows.length;u++)$(n.rows[u]).removeClass("alert"),$(n.rows[u]).removeClass("alert-dark"),$(n.rows[u]).removeAttr("data-compared");for(u=0;u<t.rows.length;u++)$(t.rows[u]).removeClass("alert"),$(t.rows[u]).removeClass("alert-warning"),$(t.rows[u]).removeAttr("data-compared");for(i=0;i<t.rows.length;i++)for(r=0;r<n.rows.length;r++)if(f=$(n.rows[r]).attr("data-compared"),f!=="true")if(n.rows[r].innerText===t.rows[i].innerText){$(t.rows[i]).removeClass("alert alert-warning");$(n.rows[r]).attr("data-compared","true");break}else $(t.rows[i]).addClass("alert alert-warning");for(r=0;r<n.rows.length;r++)for(i=0;i<t.rows.length;i++)if(f=$(t.rows[i]).attr("data-compared"),f!=="true")if(t.rows[i].innerText===n.rows[r].innerText){$(n.rows[r]).removeClass("alert alert-dark");$(t.rows[i]).attr("data-compared","true");break}else $(n.rows[r]).addClass("alert alert-dark")}function s(){var f=document.querySelector("#CustoOperacional"),e=document.querySelector("#Embalagem"),o=document.querySelector("#DespesaOperacional"),s=document.querySelector("#MargemLucro"),h=document.querySelector("#AdicionaLinha"),c=document.querySelector("#Comparar"),t,n,i,r;for(f!==null&&(c.addEventListener("click",d),f.addEventListener("click",u),e.addEventListener("click",u),o.addEventListener("click",u),s.addEventListener("click",u),h.addEventListener("click",k)),t=$("table#tabEstrutura"),n=0;n<t.length;n++)for(i=0;i<t[n].rows.length;i++)if(compute=$(t[n].rows[i]).attr("compute"),compute!=="NO"&&t[n].rows[i]!==undefined)for(r=0;r<t[n].rows[i].cells.length;r++)editable=$(t[n].rows[i].cells[r]).attr("editable"),editable==="true"&&t[n].rows[i].cells[r].addEventListener("click",y),editableProduct=$(t[n].rows[i].cells[r]).attr("editableProduct"),editableProduct==="true"&&t[n].rows[i].cells[r].addEventListener("click",p),remove=$(t[n].rows[i].cells[r]).attr("remove"),remove==="true"&&t[n].rows[i].cells[r].addEventListener("click",b)}const h=2,c=3,l=4,a=5,t=6,f=7,i=8;let y=function(n){if(n.stopPropagation(),n.preventDefault(),!(this.innerHTML.search("input")>0)){thisRow=this.parentElement;totalColumn=0;this.innerHTML='<input style="width:5em;" type="text" id="inputFor"class="form-control" value="'+this.innerText+'" >';$("#inputFor").keyup(function(){$(this).val($(this).val().replace(".",","))});let t=this.getElementsByTagName("input")[0];t.focus();t.addEventListener("blur",function(){this.outerHTML=this.value;thisRow.cells[totalColumn].focus();o(thisRow);r()})}},u=function(n){if(n.stopPropagation(),n.preventDefault(),!(this.innerHTML.search("input")>0)){thisRow=this.parentElement;totalColumn=0;this.innerHTML='<input style="width:5em;" type="text" parent-id="'+this.id+'" class="form-control" value="'+this.innerText+'" >';let t=this.getElementsByTagName("input")[0];t.focus();t.addEventListener("blur",function(){this.outerHTML=this.value;r()})}},p=function(n){var t,i;if(n.stopPropagation(),n.preventDefault(),!(this.innerHTML.search("input")>0)){t=this.parentElement;this.innerHTML='<input style="width:7em;" type="text" id="CodigoDoProduto" parent-id="'+this.id+'" class="form-control" value="'+this.innerText+'" list="ListCodigoDoProduto"  ><datalist id="ListCodigoDoProduto"><option><\/option><\/datalist >';$("#CodigoDoProduto").keyup(function(){$(this).val($(this).val().toUpperCase())});i=document.querySelector("#CodigoDoProduto");i.addEventListener("keyup",function(){i.value.length>=2&&w(i.value)});let u=this.getElementsByTagName("input")[0];u.focus();u.addEventListener("blur",function(){this.outerHTML=this.value.substring(0,15);var n=document.querySelector("#Filial").value,i=document.querySelector("#FormulaEscolhida");WebService.Init({filial:n,codigo:this.value,formula:i.innerHTML},"/SimulacaoLista/Produto/GetInformationByCodigo",function(n){n.success&&(t.cells[1].innerHTML="1",t.cells[c].setAttribute("data-tippy",""),tippy("[data-tippy]",{content:n.estrutura.DescricaoComponente}),t.cells[f].innerHTML=n.estrutura.CustoMateriPrima,t.cells[l].innerHTML=n.estrutura.Tipo,t.cells[a].innerHTML=n.estrutura.Unidade,t.cells[h].innerHTML=document.querySelector("#Produto").innerHTML,o(t),r())})})}};let b=function(n){n.stopPropagation();n.preventDefault();this.focus();this.parentElement.outerHTML="";r()};return{Init:s}}();